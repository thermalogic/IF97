//! Backward Equation for Region 3:
//!  IAPWS-IF97-S04rev :Supp-phs3-2014.pdf
//!     (h,s)->p  (3a,3b,3c)
//!         h : Specific enthalpy kJ/kg
//!         s : Specific entropy kJ/kgK
//!         P : Pressure MPa

use crate::common::constant::*;
use crate::algo::fast_ipower::sac_pow;
use crate::r3::region3_v_subregion_pT::*;

/// Backward equation for region 3a, P=f(h,s) 
pub fn hs2p3a_reg3(h:f64, s:f64)->f64
{

    const I:[i32;33] = [0, 0, 0, 1, 1, 1, 1, 1, 2, 2, 3, 3, 3, 4, 4, 4, 4, 5, 6, 7, 8, 10, 10,
                     14, 18, 20, 22, 22, 24, 28, 28, 32, 32];
    const J:[i32;33]  = [0, 1, 5, 0, 3, 4, 8, 14, 6, 16, 0, 2, 3, 0, 1, 4, 5, 28, 28, 24, 1,
                     32, 36, 22, 28, 36, 16, 28, 36, 16, 36, 10, 28];
    const n:[f64;33]  = [0.770889828326934e1, -0.260835009128688e2, 0.267416218930389e3,
                        0.172221089496844e2, -0.293542332145970e3, 0.614135601882478e3,
                        -0.610562757725674e5, -0.651272251118219e8, 0.735919313521937e5,
                        -0.116646505914191e11, 0.355267086434461e2, -0.596144543825955e3,
                        -0.475842430145708e3, 0.696781965359503e2, 0.335674250377312e3,
                        0.250526809130882e5, 0.146997380630766e6, 0.538069315091534e20,
                        0.143619827291346e22, 0.364985866165994e20, -0.254741561156775e4,
                        0.240120197096563e28, -0.393847464679496e30, 0.147073407024852e25,
                        -0.426391250432059e32, 0.194509340621077e39, 0.666212132114896e24,
                        0.706777016552858e34, 0.175563621975576e42, 0.108408607429124e29,
                        0.730872705175151e44, 0.159145847398870e25, 0.377121605943324e41];

    let nu:f64 = h / 2300.0 - 1.01;
    let sigma:f64 = s / 4.4 - 0.75;
    let mut suma:f64 = 0.0;
    for i in 0..33
    {
        suma += n[i] * sac_pow(nu, I[i]) * sac_pow(sigma, J[i]);
    }
    return 99.0 * suma;
}

/// Backward equation for region 3b, P=f(h,s)
pub fn hs2p3b_reg3(h:f64, s:f64)->f64
{

    const I:[i32;35] = [-12, -12, -12, -12, -12, -10, -10, -10, -10, -8, -8, -6, -6, -6, -6,
                     -5, -4, -4, -4, -3, -3, -3, -3, -2, -2, -1, 0, 2, 2, 5, 6, 8, 10, 14,
                     14];
    const J:[i32;35] = [2, 10, 12, 14, 20, 2, 10, 14, 18, 2, 8, 2, 6, 7, 8, 10, 4, 5, 8, 1, 3,
                     5, 6, 0, 1, 0, 3, 0, 1, 0, 1, 1, 1, 3, 7];
    const n:[f64;35] = [0.125244360717979e-12, -0.126599322553713e-1, 0.506878030140626e1,
                        0.317847171154202e2, -0.391041161399932e6, -0.975733406392044e-10,
                        -0.186312419488279e2, 0.510973543414101e3, 0.373847005822362e6,
                        0.299804024666572e-7, 0.200544393820342e2, -0.498030487662829e-5,
                        -0.102301806360030e2, 0.552819126990325e2, -0.206211367510878e3,
                        -0.794012232324823e4, 0.782248472028153e1, -0.586544326902468e2,
                        0.355073647696481e4, -0.115303107290162e-3, -0.175092403171802e1,
                        0.257981687748160e3, -0.727048374179467e3, 0.121644822609198e-3,
                        0.393137871762692e-1, 0.704181005909296e-2, -0.829108200698110e2,
                        -0.265178818131250, 0.137531682453991e2, -0.522394090753046e2,
                        0.240556298941048e4, -0.227361631268929e5, 0.890746343932567e5,
                        -0.239234565822486e8, 0.568795808129714e10];

    let nu:f64 = h / 2800.0 - 0.681;
    let sigma:f64 = s / 5.3 - 0.792;
    let mut suma:f64 = 0.0;
    for i in 0..35
    {
        suma += n[i] * sac_pow(nu, I[i]) * sac_pow(sigma, J[i]);
    }
    return 16.6 / suma;
}

///  Backward equation for region 3, P=f(h,s) 
pub fn hs2p_reg3(h:f64, s:f64)->f64
{
    if (s <= SC_WATER)
    {  return hs2p3a_reg3(h, s);}
    else
     { return  hs2p3b_reg3(h, s);}
}
